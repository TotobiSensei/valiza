{{ header }}{{ column_left }}
<div id="content">
    {% if erorr %}
    <script>
        alert("{{erorr}}")
    </script>
    {% endif %}

    <div class="page-header">
        <div class="container-fluid">
            <div class="pull-right">
                <button type="submit" form="form-module" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
                <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a>
            </div>
            <h1>{{ heading_title }}</h1>
            <ul class="breadcrumb">
                {% for breadcrumb in breadcrumbs %}
                <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title"><i class="fa fa-pencil"></i> Створення вигрузки EXCEL</h3>
        </div>
        <div class="panel-body">
            <div class="col-xs-12">
                <div class="col-xs-4 text-center type active" active id="EXPORT">EXPORT</div>
                <div class="col-xs-4 text-center type" id="IMPORT">IMPORT</div>
                <div class="col-xs-4 text-center type" id="LOGS">Журнал обміну</div>

            </div>
            <div class="col-xs-12 panel-exprot" style="display: block;">
                <form action="{{action}}" method="post" enctype="multipart/form-data" id="form-module">
                    <input type="hidden" name='export'>

                    <div class="col-md-4">
                        <div class="form-group">

                            <div class="panel-heading">
                                <h3 class="panel-title"> <i class="fas fa-check-square"></i> Вибір категорій</h3>
                            </div>
                            <div class="d-flex">
                                <button type="button" onclick="selectAll()" class="btn btn-success">Вибрати все</button>
                                <button type="button" onclick="deselectAll()" class="btn btn-danger">Прибрати все</button>
                            </div>
                            <div class="panel-body list-cat">
                                <div style="display: flex; align-items: center;" >
                                    <div 
                                        title="При выборе данного параметра, все ниже выбраные параметры не учитываются!"
                                        style="cursor: default; border: 2px solid red; border-radius: 50%; padding: 0px 10px; font-size: 18px; font-weight: 700; margin-right: 15px;"
                                    >
                                        ?
                                    </div>
                                    <label>
                                        <input name="all_products" type="checkbox" value="true">
                                        Вибрати всі товари (*Без врахування категорій)
                                    </label>
                                </div>
                                <hr style="background: black; height: 1px;">
                                {{сategories}}
                            </div>
                        </div>


                        {# <div class="form-group">

                            <div class="panel-heading">
                                <h3 class="panel-title"> <i class="fas fa-check-square"></i> Вибір по нотатку</h3>
                            </div>
                            <div class="panel-body list-notes">
                                {{notes}}
                            </div>
                        </div> #}





                    </div>
                    <div class="col-md-4">
                        <div class="form-group">

                            <div class="panel-heading">
                                <h3 class="panel-title"> <i class="fa fa-list-ul "></i> Готові вигрузки</h3>
                            </div>
                            <div class="panel-body list_excel">
                                {% for list in list_excel %}
                                <li><a href="{{list.href}} ">{{list.name}}</a>
                                    <button type="button" value="{{list.name}}" data-toggle="tooltip" title="" class="btn btn-danger" data-original-title="Видалити"><i class="fa fa-trash-o"></i></button>
                                </li>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">

                            <div class="panel-heading">
                                <h3 class="panel-title"> <i class="fa fa-check"></i> Дії</h3>
                            </div>
                            <div class="panel-body action">
                                <button class="btn btn-primary"><i class="fa fa-save"></i>Cгенирировать файл</button>
                            </div>

                        </div>
                    </div>
                </form>
            </div>
            <div class="col-xs-12 panel-import" style="display: none;">
                <form action="{{action}}" method="POST" enctype="multipart/form-data" id="form-module">
                    <input type="hidden" name='import'>

                    <div class="col-md-4">
                        <div class="form-group">
                            <div class="panel-heading ">
                                <h3 class="panel-title cheak ">
                                    <div><i class="fas fa-check-square"></i> Поля синронізації</div>
                                    <div class="cheak-elem">Обрати всі</div>
                                </h3>
                            </div>
                            <div class="panel-body list-import">
                                <div><label><input name='values[]' type='checkbox' value='name'> Название товара или услуги</label></div>
                                <div><label><input name='values[]' type='checkbox' value='description'> Описание</label></div>
                                <div><label><input name='values[]' type='checkbox' value='status'> Видимость на витрине</label></div>
                                <div><label><input name='values[]' type='checkbox' value='categories'>Категории (Размещение на сайте)</label></div>
                                <div><label><input name='values[]' type='checkbox' value='image'> Изображение</label></div>
                                <div><label><input name='values[]' type='checkbox' value='sku'> Артикул</label></div>
                                <div><label><input name='values[]' type='checkbox' value='upc'> Штрих-код</label></div>
                                <div><label><input name='values[]' type='checkbox' value='price'> Цена продажи</label></div>
                                <div><label><input name='values[]' type='checkbox' value='special'> Акционная цена</label></div>
                                <div><label><input name='values[]' type='checkbox' value='main_price'> Цена закупки</label></div>
                                <div><label><input name='values[]' type='checkbox' value='quantity'> Остаток</label></div>
                                <div><label><input name='values[]' type='checkbox' value='notes'> Заметка</label></div>
                                {% for key, attribute in attributes %}
                                    {% if attribute != "Страна" %}
                                        <div><label><input name='values[]' type="checkbox" value="attribute_{{ key }}"> {{ attribute }}</label></div>
                                    {% endif %}
                                {% endfor %}

                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <div class="panel-heading ">
                                <h3 class="panel-title">Файл</h3>
                            </div>
                            <div class="panel-body">
                                <label for="file" id="file-label" class="file-label">
                                    Перетягніть файл сюди або клікніть, щоб вибрати файл
                                    <input type="file" name="file" id="file" class="file-input">
                                </label>
                            </div>

                        </div>


                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <div class="panel-heading ">
                                <h3 class="panel-title">Дії</h3>
                            </div>
                            <div class="panel-body action">
                                <button class="btn btn-primary"><i class="fa fa-save"></i>Загрузить файл</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-xs-12 panel-logs" style="display:none;">
                <div class="col-md-{% if logs %}9{% else %}12{% endif %}">
                    <div class="form-group">
                        <div class="panel-heading ">
                            <h3 class="panel-title cheak ">
                                <div><i class="fas fa-check-square"></i> Журнал обміну</div>
                            </h3>
                        </div>
                        <div class="panel-body list-logs">
                            {% if logs %}

                            {{logs}}

                            {% else %}
                            <h3>Файл логу пустий</h3>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% if logs %}

                <div class="col-md-3">
                    <div class="panel-heading">
                        <h3 class="panel-title"> <i class="fa fa-check"></i> Дії</h3>
                    </div>

                    <div class="panel-body log-action">
                        <a href="{{link_log}}" download target="_blank">
                            <button class="btn btn-primary save-log"><i class="fa fa-save"></i>Скачати файл логів</button>
                        </a>
                        <button value="log.txt" class="btn btn-denger dell-log"><i class="fa fa-trash-o"></i>Очистити файл логів</button>

                    </div>

                </div>
                {% endif %}

            </div>

        </div>
    </div>

</div>
{{ footer }}

<script>
    document.addEventListener("DOMContentLoaded", function() {


        const cheak = document.querySelector(".cheak-elem");
        let allcheakImportCheckbox = document.querySelectorAll(".list-import input");

        cheak.addEventListener("click", function(e) {
            allcheakImportCheckbox.forEach((checkbox) => {
                checkbox.checked = true; // Встановлюємо стан "checked" для всіх чекбоксів
            });
        });

        function dellFile(button, e) {

            e.preventDefault()
            let text = button.getAttribute("value");
            let answ = confirm(`Ви впевнені?\nВи вдаляєте файл ${text}`);
            let data = {
                file_name: text
            };

            if (answ) {
                fetch("{{ delite }}".replace(/&amp;/g, '&'), {
                        method: "POST",
                        headers: {
                            'Content-Type': 'application/json' // Вказуємо, що відправляємо дані у форматі JSON
                        },
                        body: JSON.stringify(data) // Перетворюємо об'єкт JavaScript в JSON рядок
                    })
                    .then((response) => {
                        if (!response.ok) {
                            throw new Error("Произошла ошибка при выполнении запроса");
                        }

                        return response.json(); // Предполагаем, що сервер возвращает JSON
                    })
                    .then((data) => {
                        // Здесь можно обрабатывать данные, полученные от сервера
                        console.log(data);
                        if (data.success) {
                            alert(data.success)
                            window.location.reload();
                        }
                    })
                    .catch((error) => {
                        console.error(error.message);
                    });
            }

        }
        const delLog = document.querySelector("button.dell-log");
        if (delLog) {
            delLog.addEventListener("click", e => {
                dellFile(delLog, e)
            })
        }
        const buttons = document.querySelectorAll(".list_excel button");
        buttons.forEach(button => {
            button.addEventListener("click", e => {
                dellFile(button, e)

            })



            // Перебираємо елементи панелі вибору
            const allTypes = document.querySelectorAll(".type");
            const exportPanel = document.querySelector(".panel-exprot"); // Знаходимо панель EXPORT
            const importPanel = document.querySelector(".panel-import"); // Знаходимо панель IMPORT
            const logsPanel = document.querySelector(".panel-logs"); // Знаходимо панель LOGS


            allTypes.forEach(type => {
                type.addEventListener("click", () => {
                    // Перевіряємо, який елемент був клікнутий
                    if (type.id === "EXPORT") {
                        exportPanel.style.display = "block"; // Показуємо панель EXPORT
                        importPanel.style.display = "none"; // Приховуємо панель IMPORT
                        logsPanel.style.display = "none"; // Приховуємо панель LOGS

                    } else if (type.id === "IMPORT") {
                        importPanel.style.display = "block"; // Показуємо панель IMPORT
                        exportPanel.style.display = "none"; // Приховуємо панель EXPORT
                        logsPanel.style.display = "none"; // Приховуємо панель LOGS

                    } else if (type.id === "LOGS") {
                        importPanel.style.display = "none"; // Показуємо панель IMPORT
                        exportPanel.style.display = "none"; // Приховуємо панель EXPORT
                        logsPanel.style.display = "block"; // Приховуємо панель LOGS

                    }

                    // Переключаємо клас active
                    allTypes.forEach(t => t.classList.remove("active"));
                    type.classList.add("active");
                });
            });
        });
    })
</script>

<style>
    .panel-body.log-action {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .log-action button {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 10px;
        width: 180px;
    }

    .panel-body.list-logs {
        max-height: 60vh;
        overflow: auto;
        padding: 20px 5px;
    }

    label {
        cursor: pointer;
    }

    .cheak {
        display: flex !important;
        justify-content: space-between;
        cursor: pointer;
    }

    .list_excel li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 15px;
    }

    .action button {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px
    }

    .list-cat div {
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .list-cat {
        height: 500px;
        overflow: auto;
    }

    .type {
        cursor: pointer;
        transition: ease 0.3 all;
    }

    .type.active {
        font-weight: 800;
        color: green;
    }

    select#notes {
        width: 100%;
        border-radius: 20px;
        min-height: 40px;
    }
</style>

<script>
    function selectAll() {
        var checkboxes = document.querySelectorAll('.panel-body.list-cat input[type="checkbox"]');
        for (var checkbox of checkboxes) {
            checkbox.checked = true;
        }
    }

    function deselectAll() {
        var checkboxes = document.querySelectorAll('.panel-body.list-cat input[type="checkbox"]');
        for (var checkbox of checkboxes) {
            checkbox.checked = false;
        }
    }
</script>